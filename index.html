<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lab-Scale Bioreactor HMI</title>

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app" role="application" aria-label="Lab-Scale Bioreactor HMI">
    <header class="topbar" role="banner">
      <div class="brand" aria-hidden="false">
        <svg viewBox="0 0 48 48" fill="none" aria-hidden="true">
          <defs>
            <linearGradient id="g1" x1="0" x2="1">
              <stop offset="0" stop-color="#6CF5A8"/><stop offset="1" stop-color="#2de59f"/>
            </linearGradient>
          </defs>
          <rect x="2" y="6" width="44" height="34" rx="6" fill="#111"/>
          <path d="M14 30v-6c0-4 2-6 6-6s6 2 6 6v6" stroke="url(#g1)" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span>Bioreactor HMI</span>
      </div>

      <nav class="topnav" role="navigation" aria-label="Main navigation">
        <a href="#/home" data-route="home" id="nav-home" class="active" role="link" tabindex="0">Home</a>
        <a href="#/parameters" data-route="parameters" id="nav-parameters" role="link" tabindex="0">Parameters</a>
        <a href="#/graphs" data-route="graphs" id="nav-graphs" role="link" tabindex="0">Graphs</a>
        <a href="#/network" data-route="network" id="nav-network" role="link" tabindex="0">Network</a>
        <a href="#/about" data-route="about" id="nav-about" role="link" tabindex="0">About</a>
      </nav>

      <div class="top-actions" role="toolbar" aria-label="Top actions">
        <button id="muteBtn" class="btn-icon" aria-pressed="false" title="Mute/Unmute">ðŸ”Š</button>
        <button id="connectBtn" class="btn-icon" title="Open WebSocket">âŸ³ Connect</button>
      </div>
    </header>

    <main class="container" role="main">
      <section id="page-home" class="page active" aria-labelledby="home-title">
        <div style="display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:8px;">
          <h1 id="home-title" style="margin:0; font-size:1.2rem;">Home</h1>
          <div class="muted">Status: <span id="netStatus">disconnected</span></div>
        </div>

        <div class="home-grid">
          <div class="panel" aria-label="Reactor schematic panel">
            <div class="reactor-wrap" role="region" aria-label="Reactor schematic">
              <svg id="reactorSVG" viewBox="0 0 760 520" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="svgTitle svgDesc">
                <title id="svgTitle">Lab scale bioreactor schematic</title>
                <desc id="svgDesc">A stylized 3D-like cylindrical tank with agitator, sensors, inlet/outlet, LEDs and liquid fill mask.</desc>

                <defs>
                  <linearGradient id="metalGrad" x1="0" x2="1">
                    <stop offset="0" stop-color="#3a3a3a"/>
                    <stop offset="0.5" stop-color="#5a5a5a"/>
                    <stop offset="1" stop-color="#2c2c2c"/>
                  </linearGradient>

                  <linearGradient id="liquidGrad" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0" stop-color="#53E89B" stop-opacity="0.95"/>
                    <stop offset="1" stop-color="#1EA173" stop-opacity="0.85"/>
                  </linearGradient>

                  <radialGradient id="glassShine" cx="0.3" cy="0.2" r="0.9">
                    <stop offset="0" stop-color="rgba(255,255,255,0.22)"/>
                    <stop offset="1" stop-color="rgba(255,255,255,0.02)"/>
                  </radialGradient>

                  <clipPath id="tank_fill_mask">
                    <rect id="tank_fill_mask_rect" x="220" y="260" width="320" height="180"></rect>
                  </clipPath>

                  <g id="aggPivot"></g>
                </defs>

                <ellipse cx="380" cy="480" rx="160" ry="22" fill="black" opacity="0.25"/>

                <g id="tank_outer">
                  <rect x="220" y="120" width="320" height="340" rx="24" fill="url(#metalGrad)" stroke="#111" stroke-width="1"/>
                  <ellipse cx="380" cy="120" rx="160" ry="32" fill="#222" />
                  <ellipse cx="380" cy="112" rx="128" ry="22" fill="url(#glassShine)" opacity="0.18"/>
                  <rect x="220" y="112" width="320" height="16" fill="#111"/>
                </g>

                <g clip-path="url(#tank_fill_mask)" id="liquid_group">
                  <rect x="220" y="120" width="320" height="340" fill="url(#liquidGrad)" opacity="0.96" />
                  <path id="liquid_wave" d="M220 320 q40 -18 80 0 t80 0 t80 0 t80 0 v200 h-320z" fill="rgba(255,255,255,0.06)" opacity="0.6"/>
                </g>

                <g id="float_tube" transform="translate(560,160)">
                  <rect x="-6" y="0" width="12" height="260" rx="6" fill="#2b2b2b" stroke="#101010"/>
                  <circle id="float_bulb" cx="0" cy="140" r="10" fill="#ffffff" opacity="0.24" />
                  <text x="-40" y="20" fill="#9aa0a6" font-size="12">Level</text>
                </g>

                <g id="agitator_group" transform="translate(380,88)">
                  <rect x="-36" y="-66" width="72" height="36" rx="6" fill="#2b2b2b" stroke="#0f0f0f"/>
                  <rect x="-30" y="-62" width="60" height="28" rx="4" fill="#141414"/>
                  <text x="-16" y="-42" font-size="10" fill="#9aa0a6">Motor</text>
                  <rect id="shaft" x="-4" y="-60" width="8" height="200" fill="#141414"/>
                  <g id="agg_blades" transform="translate(0,110)" aria-hidden="true">
                    <g id="blade1" transform="rotate(0)">
                      <path d="M0 0 c40 -6 80 -6 120 0 c-6 24 -12 54 -18 78 c-34 4 -86 4 -132 0 c-6 -26 -12 -54 -18 -78 z" fill="#2a342d" opacity="0.95"/>
                      <path d="M0 0 c40 -6 80 -6 120 0 c-6 24 -12 54 -18 78 c-34 4 -86 4 -132 0 c-6 -26 -12 -54 -18 -78 z" fill="#6CF5A8" opacity="0.06"/>
                    </g>
                    <g id="blade2" transform="rotate(120)">
                      <path d="M0 0 c40 -6 80 -6 120 0 c-6 24 -12 54 -18 78 c-34 4 -86 4 -132 0 c-6 -26 -12 -54 -18 -78 z" fill="#2a342d" opacity="0.95"/>
                      <path d="M0 0 c40 -6 80 -6 120 0 c-6 24 -12 54 -18 78 c-34 4 -86 4 -132 0 c-6 -26 -12 -54 -18 -78 z" fill="#6CF5A8" opacity="0.06"/>
                    </g>
                    <g id="blade3" transform="rotate(240)">
                      <path d="M0 0 c40 -6 80 -6 120 0 c-6 24 -12 54 -18 78 c-34 4 -86 4 -132 0 c-6 -26 -12 -54 -18 -78 z" fill="#2a342d" opacity="0.95"/>
                      <path d="M0 0 c40 -6 80 -6 120 0 c-6 24 -12 54 -18 78 c-34 4 -86 4 -132 0 c-6 -26 -12 -54 -18 -78 z" fill="#6CF5A8" opacity="0.06"/>
                    </g>
                  </g>
                </g>

                <g id="sensors">
                  <g id="sensor_temp" transform="translate(295,240)" aria-label="Temperature probe" role="img">
                    <rect x="-2" y="-78" width="4" height="78" fill="#cfcfcf"/>
                    <circle cx="0" cy="-80" r="6" fill="#f6c6c6"/>
                    <line x1="0" y1="-30" x2="-90" y2="-10" stroke="#6CF5A8" stroke-width="2" stroke-dasharray="4 3"/>
                    <g transform="translate(-94,-20)">
                      <rect x="-6" y="-6" width="40" height="18" rx="4" fill="#101010" stroke="#222"/>
                      <text x="0" y="7" font-size="10" fill="#9aa0a6">T-sensor</text>
                    </g>
                    <text x="-22" y="10" fill="#9aa0a6" font-size="12">Temp</text>
                  </g>

                  <g id="sensor_ph" transform="translate(420,240)">
                    <rect x="-2" y="-78" width="4" height="78" fill="#cfcfcf"/>
                    <circle cx="0" cy="-80" r="6" fill="#cfe5ff"/>
                    <line x1="0" y1="-30" x2="100" y2="-10" stroke="#FFC857" stroke-width="2" stroke-dasharray="4 3"/>
                    <g transform="translate(104,-20)">
                      <rect x="-6" y="-6" width="40" height="18" rx="4" fill="#101010" stroke="#222"/>
                      <text x="0" y="7" font-size="10" fill="#9aa0a6">pH-sensor</text>
                    </g>
                    <text x="10" y="10" fill="#9aa0a6" font-size="12">pH</text>
                  </g>

                  <g id="sensor_do" transform="translate(340,320)">
                    <rect x="-2" y="-78" width="4" height="78" fill="#cfcfcf"/>
                    <circle cx="0" cy="-80" r="6" fill="#cfefff"/>
                    <line x1="0" y1="-20" x2="-140" y2="10" stroke="#7ec0ff" stroke-width="2" stroke-dasharray="4 3"/>
                    <g transform="translate(-190,20)">
                      <rect x="-6" y="-6" width="46" height="18" rx="4" fill="#101010" stroke="#222"/>
                      <text x="2" y="7" font-size="10" fill="#9aa0a6">DO-sensor</text>
                    </g>
                    <text x="-8" y="10" fill="#9aa0a6" font-size="12">DO</text>
                  </g>
                </g>

                <g id="pipes">
                  <g id="inlet" transform="translate(160,260)">
                    <rect x="-80" y="-8" width="120" height="16" rx="6" fill="#1e1e1e" stroke="#111"/>
                    <g id="valve_in" transform="translate(-10,0)">
                      <rect x="-6" y="-12" width="44" height="24" rx="6" fill="#222"/>
                      <circle cx="12" cy="0" r="6" fill="#6CF5A8"/>
                    </g>
                    <text x="-40" y="-18" font-size="11" fill="#9aa0a6">Inlet</text>
                  </g>

                  <g id="outlet" transform="translate(600,340)">
                    <rect x="0" y="-8" width="120" height="16" rx="6" fill="#1e1e1e" stroke="#111"/>
                    <g id="valve_out" transform="translate(20,0)">
                      <rect x="-6" y="-12" width="44" height="24" rx="6" fill="#222"/>
                      <circle cx="12" cy="0" r="6" fill="#FF6B6B"/>
                    </g>
                    <text x="20" y="-18" font-size="11" fill="#9aa0a6">Outlet</text>
                  </g>
                </g>

                <g id="leds" transform="translate(480,80)" aria-hidden="true">
                  <g transform="translate(0,0)">
                    <rect x="-120" y="-12" width="116" height="28" rx="6" fill="#111"/>
                    <circle id="led_heater" class="led" cx="-90" cy="2" r="6"/>
                    <text x="-78" y="6" font-size="11" fill="#9aa0a6">Heater</text>

                    <circle id="led_aeration" class="led" cx="-30" cy="2" r="6" />
                    <text x="-18" y="6" font-size="11" fill="#9aa0a6">Aeration</text>

                    <circle id="led_agitator" class="led" cx="30" cy="2" r="6" />
                    <text x="42" y="6" font-size="11" fill="#9aa0a6">Agitator</text>
                  </g>
                </g>

                <text x="260" y="470" fill="#9aa0a6" font-size="11">Cylindrical stainless tank</text>

              </svg>
            </div>

            <div style="margin-top:10px;">
              <div class="readouts" role="list" aria-label="Numeric readouts">
                <div class="readout" role="listitem" aria-label="Temperature">
                  <div class="label">Temperature (Â°C)</div>
                  <div id="tempVal" class="value" aria-live="polite">--.-</div>
                </div>
                <div class="readout" role="listitem" aria-label="pH">
                  <div class="label">pH</div>
                  <div id="phVal" class="value" aria-live="polite">--.--</div>
                </div>
                <div class="readout" role="listitem" aria-label="RPM">
                  <div class="label">RPM</div>
                  <div id="rpmVal" class="value" aria-live="polite">--</div>
                </div>
                <div class="readout" role="listitem" aria-label="Liquid level">
                  <div class="label">Liquid Level (%)</div>
                  <div id="levelVal" class="value" aria-live="polite">--</div>
                </div>
                <div class="readout" role="listitem" aria-label="Dissolved oxygen">
                  <div class="label">DO (%)</div>
                  <div id="doVal" class="value" aria-live="polite">--</div>
                </div>
                <div class="readout small" role="listitem" aria-label="Status">
                  <div class="label">Mode</div>
                  <div id="modeVal" class="value" aria-live="polite">Idle</div>
                </div>
              </div>

              <div class="controls" role="group" aria-label="Main controls">
                <button id="btnStart" class="btn-main" aria-pressed="false" title="Start run">Start</button>
                <button id="btnStop" class="btn-main" aria-pressed="false" title="Stop run">Stop</button>

                <button id="btnHeater" class="toggle" role="switch" aria-checked="false" title="Toggle heater">Heater <span style="margin-left:8px" id="spanHeaterLed"></span></button>
                <button id="btnAeration" class="toggle" role="switch" aria-checked="false" title="Toggle aeration">Aeration <span style="margin-left:8px" id="spanAerationLed"></span></button>
                <button id="btnAgitator" class="toggle" role="switch" aria-checked="false" title="Toggle agitator">Agitator <span style="margin-left:8px" id="spanAgitatorLed"></span></button>

                <button id="btnEStop" class="btn-main" title="Emergency stop" aria-label="Emergency stop">EMERGENCY STOP</button>
              </div>
            </div>
          </div>

          <div style="display:flex; flex-direction:column; gap:12px;">
            <div class="panel" aria-label="Control panel">
              <h2 style="margin:0 0 8px 0;">Quick Controls</h2>
              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <label class="tooltip" data-tip="Set temperature target.">
                  <div style="font-size:12px; color:var(--muted)">Set Temp (Â°C)</div>
                  <input id="setTempInput" type="number" min="20" max="80" step="0.1" value="37" style="width:120px; padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff;">
                </label>

                <label class="tooltip" data-tip="Set pH target.">
                  <div style="font-size:12px; color:var(--muted)">Set pH</div>
                  <input id="setPhInput" type="number" min="3.0" max="10.0" step="0.01" value="7.2" style="width:120px; padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff;">
                </label>

                <label class="tooltip" data-tip="Set RPM">
                  <div style="font-size:12px; color:var(--muted)">Set RPM</div>
                  <input id="setRpmInput" type="number" min="0" max="2000" step="1" value="300" style="width:120px; padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff;">
                </label>

                <label class="tooltip" data-tip="Set DO% target">
                  <div style="font-size:12px; color:var(--muted)">Set DO (%)</div>
                  <input id="setDoInput" type="number" min="0" max="100" step="1" value="85" style="width:120px; padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff;">
                </label>

                <label class="tooltip" data-tip="Set run duration (HH:MM)">
                  <div style="font-size:12px; color:var(--muted)">Duration (hh:mm)</div>
                  <input id="setDurationInput" type="text" inputmode="numeric" pattern="[0-9]{2}:[0-9]{2}" placeholder="01:00" style="width:120px; padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff;">
                </label>
              </div>

              <div style="display:flex; gap:8px; margin-top:12px;">
                <button id="btnApplyParams" class="btn-main" style="background:var(--panel);">Apply</button>
                <button id="btnPreviewChart" class="btn-main" style="background:var(--panel);">Open Graphs</button>
              </div>
            </div>

            <div class="panel" aria-label="Graph preview">
              <h2 style="margin:0 0 8px 0;">Realtime Graph (preview)</h2>
              <canvas id="miniChart" height="180" aria-label="Realtime chart preview"></canvas>
              <div style="margin-top:8px; display:flex; justify-content:space-between; align-items:center;">
                <div class="muted">Window: <span id="miniWindow">1m</span></div>
                <div style="display:flex; gap:8px;">
                  <button id="toggleTemp" class="link-like">Temp</button>
                  <button id="togglePh" class="link-like">pH</button>
                  <button id="toggleRpm" class="link-like">RPM</button>
                  <button id="toggleDo" class="link-like">DO</button>
                </div>
              </div>
            </div>

            <div class="panel" aria-label="System logs">
              <h2 style="margin:0 0 8px 0;">Network & System Logs</h2>
              <div id="netLogs" style="height:160px; overflow:auto; border-radius:8px; background:#141414; padding:8px; font-family:monospace; font-size:12px; color:#cbd5dc;">
                </div>
            </div>
          </div>
        </div>
      </section>

      <section id="page-parameters" class="page" aria-labelledby="params-title">
        <div class="panel">
          <h1 id="params-title">Parameters</h1>
          <form id="paramsForm" onsubmit="return false;" aria-describedby="paramsDesc">
            <div id="paramsDesc" class="muted">Adjust process setpoints and duration. Values will be validated before sending.</div>

            <div style="display:grid; grid-template-columns: repeat(2,1fr); gap:12px; margin-top:12px;">
              <label>
                <div class="muted">Set Temperature (Â°C)</div>
                <input id="setTempInput_p" type="range" min="20" max="80" step="0.1" value="37" />
                <input id="setTempInput_num" type="number" min="20" max="80" step="0.1" value="37" />
              </label>

              <label>
                <div class="muted">Set pH</div>
                <input id="setPhInput_p" type="range" min="3.0" max="10.0" step="0.01" value="7.2" />
                <input id="setPhInput_num" type="number" min="3.0" max="10.0" step="0.01" value="7.2" />
              </label>

              <label>
                <div class="muted">Set RPM</div>
                <input id="setRpmInput_p" type="range" min="0" max="2000" step="1" value="300" />
                <input id="setRpmInput_num" type="number" min="0" max="2000" step="1" value="300" />
              </label>

              <label>
                <div class="muted">Duration (hh:mm)</div>
                <input id="setDurationInput_p" type="text" placeholder="01:00" />
              </label>

              <label>
                <div class="muted">Set DO (%)</div>
                <input id="setDoInput_p" type="range" min="0" max="100" step="1" value="85" />
                <input id="setDoInput_num" type="number" min="0" max="100" step="1" value="85" />
              </label>
            </div>

            <div style="margin-top:12px;">
              <button id="btnApplyParams_p" class="btn-main" style="background:var(--panel)">Apply</button>
            </div>
          </form>
        </div>
      </section>

      <section id="page-graphs" class="page" aria-labelledby="graphs-title">
        <div class="panel">
          <h1 id="graphs-title">Graphs</h1>
          <div style="display:flex; gap:12px; align-items:center; margin-top:8px;">
            <div class="muted">Time window:</div>
            <button class="link-like time-window-btn" data-window="1">1m</button>
            <button class="link-like time-window-btn" data-window="5">5m</button>
            <button class="link-like time-window-btn" data-window="30">30m</button>

            <div style="margin-left:auto; display:flex; gap:8px;">
              <button id="exportCsv" class="btn-main" style="background:var(--panel)">Export CSV</button>
            </div>
          </div>

          <div style="margin-top:12px;">
            <canvas id="mainChart" height="260" aria-label="Realtime multi-series chart"></canvas>
          </div>
        </div>
      </section>

      <section id="page-network" class="page" aria-labelledby="network-title">
        <div class="panel">
          <h1 id="network-title">Network</h1>
          <div style="display:flex; gap:8px; margin-top:8px; align-items:center;">
            <div style="display:flex; flex-direction:column; gap:6px;">
              <div>SSID: <span id="netSSID">--</span></div>
              <div>IP: <span id="netIP">--</span></div>
              <div>MAC: <span id="netMAC">--</span></div>
              <div>Port: <span id="netPort">--</span></div>
              <div>Connection: <span id="netStatus">disconnected</span></div>
            </div>

            <div style="margin-left:auto;">
              <button id="btnScan" class="btn-main" style="background:var(--panel)">Scan & Connect</button>
            </div>
          </div>

          <h2 style="margin-top:12px;">Network Logs</h2>
          <div id="netLogsNetwork" style="height:160px; overflow:auto; border-radius:8px; background:#141414; padding:8px; font-family:monospace; font-size:12px; color:#cbd5dc;">
          </div>
        </div>
      </section>

      <section id="page-about" class="page" aria-labelledby="about-title">
        <div class="panel" style="position:relative; overflow:hidden;">
          <svg style="position:absolute; right:-120px; bottom:-120px; opacity:0.04;" width="420" height="420" viewBox="0 0 200 200" aria-hidden="true">
            <circle cx="100" cy="100" r="80" fill="#6CF5A8"/>
            <rect x="60" y="40" width="80" height="80" rx="10" fill="#111"/>
          </svg>

          <h1 id="about-title">About</h1>
          <div class="muted">Project: Lab-Scale Bioreactor HMI</div>
          <div style="margin-top:8px;">
            <strong>Version:</strong> 1.0.0<br/>
            <strong>Author:</strong> Senior Frontend Engineer & UI/UX Designer<br/>
            <strong>Description:</strong> Single-file, dark industrial HMI for monitoring and controlling a lab bioreactor. Includes SVG schematic, realtime charts, WebSocket hooks and safety controls.<br/>
            <strong>Date:</strong> <span id="buildDate"></span>
          </div>
        </div>
      </section>

    </main>
  </div>

  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h2 id="modalTitle">Confirm</h2>
      <div id="modalBody" style="margin-top:8px;">Are you sure?</div>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
        <button id="modalCancel" class="btn-main" style="background:var(--panel)">Cancel</button>
        <button id="modalConfirm" class="btn-main" style="background:var(--accent); color:#0b0b0b">Confirm</button>
      </div>
    </div>
  </div>

  <script src="script.js"></script>

</body>
</html>
